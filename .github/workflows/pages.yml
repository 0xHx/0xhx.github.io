# Simple workflow for deploying static content to GitHub Pages
name: Deploy static content to Pages

on:
  workflow_dispatch:
  # Runs on pushes targeting the default branch
  # push:
  #   branches: ["main"]
  schedule:
    - cron: "12 4 * * 6"

permissions:
  contents: read
  pages: write
  id-token: write

env:
  BSITE: "d3d3LnF1aW50eXBlLmNvbQo="
  SITE: null
  PATH_ROOT: null

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: us
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Init Ubuntu
        run: |
          sudo -E apt-get -qq update
          sudo -E apt-get -qq install gnupg unzip git   wget curl
          sudo mkdir -p /workdir
          sudo chown $USER:$GROUPS /workdir
          sudo -E apt-get -qq autoremove --purge
          sudo -E apt-get -qq clean

      - name: Setup Pages
        uses: actions/configure-pages@v2

      - name: GetHtmls
        id: gethtml
        run: |
          echo ${{ secrets.GPG_XSTREAM2 }} > /tmp/xstream2.gpg.txt
          gpg --import /tmp/xstream2.gpg.txt
          gpg --output file.txt --decrypt file.txt.gpg
          cat file.txt
          cd /workdir
          # site=`echo ${{ env.BSITE }}|base64 -d`
          # echo "SITE=$site" >> $GITHUB_ENV
          # echo "PATH_ROOT=/workdir/$site" >> $GITHUB_ENV
          # wget --user-agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_16) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.2 Safari/605.1.15" -q -k -m -np  https://${site}/ || true
          # cd ${site}
          # echo "User-agent: *" > robots.txt
          # echo "Disallow: /" >> robots.txt

      # - name: Upload artifact
      #   uses: actions/upload-pages-artifact@v1
      #   with:
      #     # Upload entire repository
      #     path: ${{ env.PATH_ROOT }}

      # - name: Deploy to GitHub Pages
      #   id: deployment
      #   uses: actions/deploy-pages@v1
